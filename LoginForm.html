<html><head>
  <script src="js/chromebookcheck.js"></script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>shatter | Login Form</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #121212;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      color: #e0e0e0;
    }
    .language-buttons {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin: 20px 0;
    }
    .language-buttons button {
      background-color: #000;
      color: #e0e0e0;
      border: 1px solid #444;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 1rem;
    }
    .language-buttons button:hover {
      background-color: #1a1a1a;
    }
    .login-container {
      background-color: #1e1e1e;
      padding: 2rem;
      border-radius: 15px;
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.4);
      width: 90%;
      max-width: 600px;
    }
    .form-section {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }
    .photo-section {
      display: flex;
      justify-content: space-around;
      margin-bottom: 1.5rem;
    }
    .photo-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.5rem;
    }
    .profile-picture, .school-photo {
      width: 120px;
      height: 120px;
      border-radius: 15px;
      background-color: #2a2a2a;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
    }
    .profile-picture img, .school-photo img {
      max-width: 100%;
      max-height: 100%;
      object-fit: cover;
    }
    input {
      padding: 0.75rem;
      border: 1px solid #444;
      border-radius: 8px;
      background-color: #2a2a2a;
      color: #e0e0e0;
      font-size: 1rem;
    }
    input:focus {
      outline: none;
      border-color: #666;
    }
    button {
      background-color: #000;
      color: #e0e0e0;
      border: 1px solid #444;
      padding: 0.75rem 1rem;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 1rem;
    }
    button:hover {
      background-color: #1a1a1a;
    }
    button:disabled {
      background-color: #333;
      color: #666;
      cursor: not-allowed;
    }
    .password-strength {
      font-size: 0.9rem;
      margin-top: 0.5rem;
    }
    .hidden {
      display: none;
    }
    #emailSection {
      text-align: center;
      margin-top: 2rem;
    }
    .photo-label {
      font-size: 0.8rem;
      color: #888;
      margin-top: 0.2rem;
    }
  </style>
  </head>
  <body>
    <div class="language-buttons">
      <button onclick="changeLanguage('en')">English</button>
      <button onclick="changeLanguage('es')">Español</button>
      <button onclick="changeLanguage('ru')">Русский</button>
      <button onclick="changeLanguage('uk')">Українська</button>
    </div>
    <div class="login-container">
      <div class="form-section" id="section1">
        <div class="photo-section">
          <div class="photo-container">
            <div class="profile-picture" id="profilePicture">
              <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="#e0e0e0" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
              </svg>
            </div>
            <button id="uploadProfileButton" data-en="Upload Profile Picture" data-es="Subir Foto de Perfil" data-ru="Загрузить Фото Профиля" data-uk="Завантажити Фото Профілю">Upload Profile Picture</button>
            <span class="photo-label" data-en="*required" data-es="*obligatorio" data-ru="*обязательно" data-uk="*обов'язково">*required</span>
          </div>
          <div class="photo-container">
            <div class="school-photo" id="schoolPhoto">
              <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="#e0e0e0" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                <circle cx="8.5" cy="8.5" r="1.5"></circle>
                <polyline points="21 15 16 10 5 21"></polyline>
              </svg>
            </div>
            <button id="uploadSchoolPhotoButton" data-en="Upload School Photo" data-es="Subir Foto Escolar" data-ru="Загрузить Школьное Фото" data-uk="Завантажити Шкільне Фото">Upload School Photo</button>
            <span class="photo-label" data-en="optional" data-es="opcional" data-ru="необязательно" data-uk="необов'язково">optional</span>
          </div>
        </div>
        <input type="text" id="username" data-en="Username" data-es="Nombre de Usuario" data-ru="Имя пользователя" data-uk="Ім'я користувача" placeholder="Username" required>
        <input type="password" id="password" data-en="Password" data-es="Contraseña" data-ru="Пароль" data-uk="Пароль" placeholder="Password" required>
        <div class="password-strength" id="passwordStrength"></div>
        <button id="togglePassword" data-en="Show Password" data-es="Mostrar Contraseña" data-ru="Показать Пароль" data-uk="Показати Пароль">Show Password</button>
        <button id="nextButton" onclick="showSection2()" data-en="Next" data-es="Siguiente" data-ru="Далее" data-uk="Далі">Next</button>
      </div>
      <div class="form-section hidden" id="section2">
        <input type="text" id="firstName" data-en="First Name (required)" data-es="Nombre (obligatorio)" data-ru="Имя (обязательно)" data-uk="Ім'я (обов'язково)" placeholder="First Name (required)" required>
        <input type="text" id="lastName" data-en="Last Name (required)" data-es="Apellido (obligatorio)" data-ru="Фамилия (обязательно)" data-uk="Прізвище (обов'язково)" placeholder="Last Name (required)" required>
        <input type="email" id="schoolEmail" data-en="School Email (required)" data-es="Correo Escolar (obligatorio)" data-ru="Школьная Почта (обязательно)" data-uk="Шкільна Пошта (обов'язково)" placeholder="School Email (required)" required>
        <button onclick="generateLogin()" data-en="Generate Login" data-es="Generar Inicio de Sesión" data-ru="Создать Логин" data-uk="Створити Логін">Generate Login</button>
        <button onclick="showSection1()" data-en="Back" data-es="Atrás" data-ru="Назад" data-uk="Назад">Back</button>
      </div>
      <div id="emailSection" class="hidden">
        <p data-en="If the automatic email doesn't work, send us one with the header/title 'shatter login request' then attach the zip file" 
           data-es="Si el correo automático no funciona, envíenos uno con el encabezado/título 'Solicitud de inicio de sesión de shatter' y adjunte el archivo zip" 
           data-ru="Если автоматическая отправка электронной почты не работает, отправьте нам письмо с заголовком 'Запрос на вход в shatter' и прикрепите zip-файл" 
           data-uk="Якщо автоматична електронна пошта не працює, надішліть нам лист із заголовком 'Запит на вхід до shatter' та прикріпіть zip-файл">
          If the automatic email doesn't work, send us one with the header/title 'shatter login request' then attach the zip file
        </p>
        <button onclick="sendEmail()" data-en="Send Email" data-es="Enviar Correo" data-ru="Отправить Письмо" data-uk="Надіслати Лист">Send Email</button>
        <p>sshlvl.contact@gmail.com</p>
      </div>
    </div>
  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
<script>
  const { jsPDF } = window.jspdf;

  const profilePicture = document.getElementById('profilePicture');
  const schoolPhoto = document.getElementById('schoolPhoto');
  const uploadProfileButton = document.getElementById('uploadProfileButton');
  const uploadSchoolPhotoButton = document.getElementById('uploadSchoolPhotoButton');
  const profileFileInput = document.createElement('input');
  profileFileInput.type = 'file';
  profileFileInput.accept = 'image/*';
  const schoolPhotoInput = document.createElement('input');
  schoolPhotoInput.type = 'file';
  schoolPhotoInput.accept = 'image/*';

  uploadProfileButton.addEventListener('click', () => profileFileInput.click());
  uploadSchoolPhotoButton.addEventListener('click', () => schoolPhotoInput.click());

  profileFileInput.addEventListener('change', (e) => handleImageUpload(e, profilePicture, 'profilePicture'));
  schoolPhotoInput.addEventListener('change', (e) => handleImageUpload(e, schoolPhoto, 'schoolPhoto'));

  function handleImageUpload(e, imgContainer, storageKey) {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = (e) => {
        imgContainer.innerHTML = `<img src="${e.target.result}" alt="${storageKey === 'profilePicture' ? 'Profile picture' : 'School photo'}">`;
        localStorage.setItem(storageKey, e.target.result);
      };
      reader.readAsDataURL(file);
    }
  }

  // Hash the password using SHA-256
  async function hashPassword(password) {
    const encoder = new TextEncoder();
    const data = encoder.encode(password);
    const hashBuffer = await crypto.subtle.digest('SHA-256', data);
    const hashArray = Array.from(new Uint8Array(hashBuffer)); // Convert buffer to byte array
    const hashHex = hashArray.map(byte => byte.toString(16).padStart(2, '0')).join('');
    return hashHex; // Return the hashed password as a hex string
  }

  async function generateLogin() {
    const username = document.getElementById('username').value;
    const password = passwordInput.value;
    const firstName = document.getElementById('firstName').value;
    const lastName = document.getElementById('lastName').value;
    const schoolEmail = document.getElementById('schoolEmail').value;

    if (!username || !password || !firstName || !lastName || !schoolEmail) {
      alert('Please fill in all required fields.');
      return;
    }

    if (password.length < 5) {
      alert('Password must be at least 5 characters long.');
      return;
    }

    const hashedPassword = await hashPassword(password); // Hash the password

    const loginData = {
      username: username,
      password: hashedPassword, // Use the hashed password
      firstName: firstName,
      lastName: lastName,
      schoolEmail: schoolEmail,
      profilePicture: localStorage.getItem('profilePicture'),
      schoolPhoto: localStorage.getItem('schoolPhoto')
    };

    console.log('Login data:', loginData);
    generatePDFAndZip(loginData);
  }

  async function generatePDFAndZip(data) {
    const doc = new jsPDF();
    doc.setFontSize(16);
    doc.text('Student Login Information', 20, 20);
    
    doc.setFontSize(12);
    doc.text(`Username: ${data.username}`, 20, 40);
    doc.text(`Password: ${data.password}`, 20, 50); // Show hashed password
    doc.text(`First Name: ${data.firstName}`, 20, 60);
    doc.text(`Last Name: ${data.lastName}`, 20, 80);
    doc.text(`School Email: ${data.schoolEmail}`, 20, 100);
    
    doc.text("This information is to make sure you are a student enrolled at Clackamas Highschool.", 20, 120);
    doc.text("This doubles as an anti-ban evasion measure.", 20, 130);

    if (data.profilePicture) {
      doc.addImage(data.profilePicture, 'JPEG', 20, 150, 50, 50);
      doc.text("Profile Picture", 20, 210);
    }

    if (data.schoolPhoto) {
      doc.addImage(data.schoolPhoto, 'JPEG', 100, 150, 50, 50);
      doc.text("School Photo", 100, 210);
    }

    const pdfName = `${data.lastName}_${data.firstName}_Login_Info.pdf`;
    const pdfBlob = doc.output('blob');

    // Create a text file with the data (excluding images)
    const textFileContent = `
      Username: ${data.username}
      Password: ${data.password}
      First Name: ${data.firstName}
      Last Name: ${data.lastName}
      School Email: ${data.schoolEmail}
      Profile Picture: ${data.profilePicture ? 'Available' : 'Not provided'}
      School Photo: ${data.schoolPhoto ? 'Available' : 'Not provided'}
    `;

    const textFileBlob = new Blob([textFileContent], { type: 'text/plain' });

    const zip = new JSZip();
    zip.file(pdfName, pdfBlob);
    zip.file(`${data.lastName}_${data.firstName}_Login_Data.txt`, textFileBlob);

    if (data.profilePicture) {
      const profilePicBlob = await fetch(data.profilePicture).then(r => r.blob());
      zip.file("profile_picture.jpg", profilePicBlob);
    }

    if (data.schoolPhoto) {
      const schoolPhotoBlob = await fetch(data.schoolPhoto).then(r => r.blob());
      zip.file("school_photo.jpg", schoolPhotoBlob);
    }

    zip.generateAsync({type:"blob"}).then(function(content) {
      const zipFileName = `${data.lastName}_${data.firstName}_Login_Package.zip`;
      saveAs(content, zipFileName);
      
      // Open email client
      const subject = "shatter login request";
      const body = `Please find attached the login request package for ${data.firstName} ${data.lastName}.`;
      const mailtoLink = `mailto:sshlvl.contact@gmail.com?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
      window.location.href = mailtoLink;
      
      // Show email section
      document.getElementById('section2').classList.add('hidden');
      document.getElementById('emailSection').classList.remove('hidden');
    });
  }

</script>

  </body>
  </html>
